<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.jpym.ymfrontgm.dao.FundDocumentDao">
    <!--基金概况-->
    <resultMap id="FundIntroductionModel" type="com.jpym.ymfrontgm.model.FundIntroductionModel">
        <result property="fundcode" column="fund_code" jdbcType="VARCHAR"></result>
        <result property="fundname" column="fund_name" jdbcType="VARCHAR"></result>
        <result property="funddate" column="fund_date" jdbcType="VARCHAR"></result>
        <result property="fdtotunit" column="fd_tot_unit" jdbcType="VARCHAR"></result>
        <result property="fdnature" column="fd_nature" jdbcType="VARCHAR"></result>
        <result property="managername" column="manager_name" jdbcType="VARCHAR"></result>
        <result property="trusteename" column="trustee_name" jdbcType="VARCHAR"></result>
        <result property="keepername" column="keeper_name" jdbcType="VARCHAR"></result>
    </resultMap>

    <select id="searchFundIntroduction" parameterType="String" resultMap="FundIntroductionModel">
        SELECT
        vsfg.fund_code AS fund_code,
        --基金代码
        vsfg.fund_name AS fund_name,
        --基金名称
        vsfg.fund_date AS fund_date,
        --基金成立日期
        vsfg.fd_tot_unit AS fd_tot_unit,
        --基金规模(元)
        vsfg.fd_nature AS fd_nature,
        --基金类型名称
        vsfg.manager_name AS manager_name,
        --基金经理名称
        vsfg.trustee_name AS trustee_name,
        --托管行名称(基金托管人)
        vsfg.keeper_name AS keeper_name --管理人名称(基金管理人)
        FROM vw_sf_fund_general vsfg --基金概况表
        WHERE vsfg.fund_code = #{fund_code}
    </select>
    <!--资产分布-->
    <resultMap id="FundAssetComponent" type="com.jpym.ymfrontgm.model.FundAssetComponentModel">
        <result property="key1" column="key1" jdbcType="VARCHAR"></result>
        <result property="equityinverto" column="equityinve_rto" jdbcType="VARCHAR"></result>
        <result property="key2" column="key2" jdbcType="VARCHAR"></result>
        <result property="curfdsrto" column="curfds_rto" jdbcType="VARCHAR"></result>
        <result property="key3" column="key3" jdbcType="VARCHAR"></result>
        <result property="otherrto" column="other_rto" jdbcType="VARCHAR"></result>
    </resultMap>
    <select id="searchFundAssetComponent" parameterType="String" resultMap="FundAssetComponent">
        SELECT
        ftfb.FSYMBOL AS fund_code,
        --基金代码
        ftfb.FDSNAME AS fund_name,
        --基金名称
        '1' AS key1,
        nvl(ftfa.SKRATIO, 0) AS equityinve_rto,
        --1.权益投资占净值比例(股票)
        '2' AS key2,
        nvl(ftfa.CURFDSRTO, 0) AS curfds_rto,
        --6.货币市场工具投资占净值比例%(货币)
        '3' AS key3,
        (100 - nvl(ftfa.SKRATIO, 0) - nvl(ftfa.CURFDSRTO, 0)) AS other_rto --3.基金投资市值占净值比例 %
        FROM finchina.tq_fd_basicinfo @finchinadb ftfb, --基金基本信息
        finchina.TQ_FD_ASSETPORTFOLIO @finchinadb ftfa, --基金资产组合
        ( SELECT
        ftfa.SECURITYID,
        MAX(ftfa.REPORTDATE) AS REPORTDATE
        FROM finchina.TQ_FD_ASSETPORTFOLIO @finchinadb ftfa --基金资产组合
        GROUP BY ftfa.SECURITYID) ftfaa
        WHERE ftfb.SECURITYID = ftfa.SECURITYID
        AND ftfb.SECURITYID = ftfaa.SECURITYID
        AND ftfa.REPORTDATE = ftfaa.REPORTDATE
        AND ftfb.FSYMBOL = #{fund_code}
    </select>
    <!--十大重仓股-->
    <resultMap id="TopTenStocksModel" type="com.jpym.ymfrontgm.model.TopTenStocksModel">
        <result property="skcode" column="sk_code" jdbcType="VARCHAR"></result>
        <result property="skname" column="sk_name" jdbcType="VARCHAR"></result>
        <result property="accstkrto" column="accstk_rto" jdbcType="VARCHAR"></result>
    </resultMap>
    <select id="searchTopTenStocks" parameterType="String" resultMap="TopTenStocksModel">
        SELECT
        ftfb.FSYMBOL AS fund_code,
        --基金代码
        ftfb.FDSNAME AS fund_name,
        --基金名称
        bb.SKCODE AS sk_code,
        --股票代码
        bb.SKNAME AS sk_name,
        --股票名称
        bb.ACCSTKRTO AS accstk_rto --占股票比例 %
        FROM finchina.tq_fd_basicinfo @finchinadb ftfb, --基金基本信息
        ( SELECT
        aa.SECURITYID,
        aa.SKCODE,
        aa.SKNAME,
        aa.CIRCMODE,
        aa.ENDDATE,
        aa.ACCSTKRTO
        FROM ( SELECT
        ftfs.SECURITYID,
        ftfs.SKCODE,
        ftfs.CIRCMODE,
        MAX(ftfs.SKNAME) AS SKNAME,
        MAX(ftfs.ENDDATE) AS ENDDATE,
        MAX(ftfs.ACCSTKRTO) AS ACCSTKRTO
        FROM finchina.TQ_FD_SKDETAIL @finchinadb ftfs --基金投资股票明细
        GROUP BY ftfs.SECURITYID, ftfs.SKCODE, ftfs.CIRCMODE) aa
        WHERE aa.ACCSTKRTO IS NOT NULL
        ORDER BY aa.ACCSTKRTO DESC ) bb
        WHERE ftfb.SECURITYID = bb.SECURITYID
        AND ftfb.FSYMBOL = #{fund_code}
        AND ROWNUM &lt;= 10
    </select>
</mapper>

